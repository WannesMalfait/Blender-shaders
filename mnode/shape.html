<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Shape - Blender Shaders</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Blender shaders</a></li><li class="chapter-item expanded affix "><a href="../shaders.html">What is a shader</a></li><li class="chapter-item expanded "><a href="../mnode/index.html"><strong aria-hidden="true">1.</strong> The math node</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mnode/sockets.html"><strong aria-hidden="true">1.1.</strong> Sockets</a></li><li class="chapter-item expanded "><a href="../mnode/basic_ops.html"><strong aria-hidden="true">1.2.</strong> Basic operations</a></li><li class="chapter-item expanded "><a href="../mnode/shape.html" class="active"><strong aria-hidden="true">1.3.</strong> Shape</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.4.</strong> Repetition</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.5.</strong> Coordinates</div></li></ol></li><li class="chapter-item expanded "><a href="../resources.html">Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Blender Shaders</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/WannesMalfait/Blender-shaders" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#shape" id="shape">Shape</a></h1>
<p>We have just learned how to transform a range using the <code>Math</code> node. Now it is time to also change the shape, for which we will be using the <code>Math</code> node as well. The functions that we will be looking at are <code>Power</code>, <code>Sine</code>, <code>Smoothstep</code> and <code>Smootherstep</code>.</p>
<h2><a class="header" href="#power" id="power">Power</a></h2>
<p>The <code>Power</code> mode of the math node, is a powerful tool that allows us to change the shape or interpolation of a gradient. The mathematical operation is \(a^b\), as is also shown in the tooltip. There are two ways to use this:</p>
<ol>
<li>We let <code>a</code> be constant, and plug the range into the <code>b</code> socket. This gives us an exponential function with base <code>a</code>. If we choose <code>a</code> to be 2, then we would get the function \(2^x\). The exponential function is not so useful when changing the shape, but comes up a lot in mathematical formulas. </li>
<li>In the other case we make <code>b</code> constant and plug the range into the <code>a</code> socket. In this case we are raising the range to the <code>b</code>-th power. This is something that we will use a lot in the future. We will refer to it as the power function from now on.</li>
</ol>
<p>The two functions look like this:</p>
<iframe src="https://graphtoy.com/?f1(x,t)=(sin(t)+1)*5&v1=false&f2(x,t)=pow(f1(x,t),x)&v2=true&f3(x,t)=pow(x,f1(x,t))&v3=true&f4(x,t)=&v4=false&f5(x,t)=&v5=false&f6(x,t)=&v6=false&grid=true&coords=-0.221702458210423,1.253803500548723,2.3859407407407427"
name="Power and Exponential function" height = "700" style="border: none;display: block; margin: 2 auto; width: 100%"></iframe>
<p>The constant value is animated through time between 0 and 10 by a sine wave, an incredibly useful function that we will cover soon. Feel free to experiment by changing the values of the functions.</p>
<p>Here are some observations we can make from the graph</p>
<ul>
<li>The functions seem to flip at a certain threshold, to be exact at a value of 1.</li>
<li>The power function is only shown on the right hand side (the positive x axis).</li>
<li>The power function always passes through the points <code>(0,0)</code> and <code>(1,1)</code>, and is constantly rising (i.e. as you move from right to left the values increase). </li>
<li>The exponential function always passes through <code>(0,1)</code>.</li>
</ul>
<p>The third property is the most important one. Another way to formulate it is as follows: &quot;If you plug a <code>[0, 1]</code> range in the power function, you get back a <code>[0, 1]</code> range, but with a different shape&quot;. This property is also true for the other functions that we will be looking at. If we look at the shape of the curve, we can see that it is not flat at the points <code>(0,0)</code>and <code>(1,1)</code>. This means that we might get sharp transitions when combining this function with others. The following three functions fix this problem.</p>
<h2><a class="header" href="#sine-smooth-and-smoother" id="sine-smooth-and-smoother">Sine, Smooth and Smoother</a></h2>
<p>We will limit ourselves to the range <code>[0, 1]</code> for these functions, as this makes things considerably easier. At the end of the section we will see how we can overcome this limitation.</p>
<h3><a class="header" href="#derivatives" id="derivatives">Derivatives</a></h3>
<p>To make a function that is flat at the edges, we first have to define what it means for a function to be flat. Intuitively a function can be considered flat at a point, if we can balance a book on the graph of the function. A more mathematical way would be to say that the function has a slope or derivative of zero at that point. Intuitively the slope says by how much a function is rising at that point. If the slope is negative, the function is decreasing, and if the slope is positive it is increasing. When the slope is 0, it is neither increasing nor decreasing and thus flat. The following image illustrates the different concepts we just talked about.</p>
<p><img src="images/derivatives.png" alt="Derivatives illustration" /></p>
<p>What follows is a bit more of a technical explanation, so feel free to skip over it and go straight to the <a href="#summary">summary</a>.</p>
<h3><a class="header" href="#construction-of-the-functions" id="construction-of-the-functions">Construction of the functions</a></h3>
<p>The simplest kinds of functions are the polynomials, they form the building blocks for more complex functions. Not only are they simple to write down, they can also be evaluated very quickly, making them ideal for computer graphics. Another useful property of polynomials is that, through \(n+1\) distinct points there is a unique polynomial of degree \(n\), a more general formulation of the well known property that two points determine a line. So what degree polynomial do we need to get a function that satisfies the properties we want? The properties are:</p>
<ul>
<li>Goes through <code>(0,0)</code> and <code>(1,1)</code></li>
<li>It is flat at <code>(0,0)</code> and <code>(1,1)</code></li>
</ul>
<p>These are four conditions, meaning that we have a unique polynomial of degree 3 which satisfies these properties. This polynomial, commonly known as <code>Smoothstep</code>, looks like this
<img src="images/smoothstep.png" alt="Smoothstep" />
\[
-2x^3+3x^2 = x\cdot x\cdot (3-2\cdot x)
\]
The right hand side is the one used in computer graphics, because it requires less computational steps to evaluate than the one on the left. Anyone who has had an introduction to calculus should be able to verify that this function does indeed meet the constrains. This function satisfies the properties we have described, but is not &quot;smooth&quot; enough in some cases. To fix this we use the so-called <code>Smootherstep</code>, which adds two extra conditions.</p>
<ul>
<li>Goes through <code>(0,0)</code> and <code>(1,1)</code></li>
<li>It is flat at <code>(0,0)</code> and <code>(1,1)</code></li>
<li>The second derivative (the derivative of the derivative) is flat at <code>(0,0)</code> and <code>(1,1)</code></li>
</ul>
<p>The new conditions ensure that the boundaries are very flat. Because we have 6 conditions, we now need a degree 5 polynomial.
<img src="images/smootherstep.png" alt="Smootherstep" /> 
\[
6x^5-15x^4+10x^3 = x\cdot x\cdot x\cdot (x\cdot (x\cdot 6-15)+10)
\]</p>
<p>What if we don't want to use polynomials? In that case, good candidates are the trigonometric functions like <code>Sine</code>, <code>Cosine</code> and <code>Tangent</code>. The problem here is that they are more expensive to evaluate, and less suited for the task. Another reason that we don't want to use them here, is that they are approximated very well by polynomials. In fact any continuous function on a closed interval can be approximated as closely as desired by polynomials, this result is known as the Stone-Weierstrass theorem. This means that we are finding more complex polynomials to solve the same problems. If we do want to use <code>Sine</code>, we have to do some transforms on ranges to get it to line up. We will go into more detail on the <code>Sine</code> function when we talk about repetitions.</p>
<p><img src="images/sin.png" alt="Sine wave" /></p>
<p>The value of <code>Sine</code>, goes from -1 to 1 as the input goes from \(-\pi/2\) to \(\pi/2\). Luckily for us it's already flat at the edges. Our goal is to make it go from 0 to 1 as the input goes from 0 to 1. To do this, we can use similar steps to the ones we used for the <code>Map Range</code> node. To go from <code>[-1,1]</code> to <code>[0,1]</code>, we simply add 1 and divide by 2. For the input we multiply \(x\) by \(\pi\) and add \(-\pi/2\). The final function looks like this:
\[
\frac{\sin(\pi x - \pi /2)+1}{2}
\]</p>
<h2><a class="header" href="#different-ranges" id="different-ranges">Different ranges</a></h2>
<p>To make the functions work on ranges other than <code>[0,1]</code> we can use the steps we used to create the <code>Map Range</code> node from scratch, with one new step in the middle. Like before we have an input and an output range, e.g. <code>[a,b]</code> and <code>[c,d]</code></p>
<ul>
<li>First remap the range to <code>[0,1]</code> by subtracting <code>a</code> and dividing by <code>b</code> - <code>a</code>.</li>
<li>At this point it is possible that the values exceed the <code>[0,1]</code> range, if the actual input exceeded the <code>[a,b]</code> range. To fix this we <code>Clamp</code> the input between 0 and 1, i.e. values less than 0 go to 0, and values greater than 1 go to 1. Now we apply the function to the clamped range.</li>
<li>We can now remap the range (with a changed shape) from <code>[0,1]</code> to <code>[c,d]</code>, by multiplying by <code>d</code> - <code>c</code> and adding <code>c</code>.</li>
</ul>
<p>The updated node group looks like this:</p>
<p><img src="images/map_range_smooth.png" alt="Smoothstep version of map range" /></p>
<p>Making the <code>Smoothstep</code> node group is left as an exercise. This now has basically the same functionality as the actual <code>Map Range</code> node.</p>
<h2><a class="header" href="#summary" id="summary">Summary</a></h2>
<p>Here is a plot of all the functions we looked at.</p>
<iframe src="https://graphtoy.com/?f1(x,t)=(sin(t)+1)*5&v1=false&f2(x,t)=x&v2=false&f3(x,t)=pow(x,f1(x,t))&v3=true&f4(x,t)=x*x*(3-2*x)&v4=true&f5(x,t)=(sin(x*PI-PI/2)+1)/2&v5=true&f6(x,t)=x*x*x*(x*(x*6-15)+10)&v6=true&grid=true&coords=0.5,0.5,0.6666666666666666"
name="Different shapes" height = "700" style="border: none; display: block; margin: 2 auto; width: 100%"> </iframe>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../mnode/basic_ops.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../resources.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../mnode/basic_ops.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../resources.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
