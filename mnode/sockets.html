<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sockets - Blender Shaders</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Blender shaders</a></li><li class="chapter-item expanded affix "><a href="../shaders.html">What is a shader</a></li><li class="chapter-item expanded "><a href="../mnode/index.html"><strong aria-hidden="true">1.</strong> The math node</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../mnode/sockets.html" class="active"><strong aria-hidden="true">1.1.</strong> Sockets</a></li><li class="chapter-item expanded "><a href="../mnode/basic_ops.html"><strong aria-hidden="true">1.2.</strong> Basic operations</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.3.</strong> Coordinates</div></li></ol></li><li class="chapter-item expanded "><a href="../resources.html">Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Blender Shaders</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/WannesMalfait/Blender-shaders" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#sockets" id="sockets">Sockets</a></h1>
<p>When working with nodes, it is very important to keep in mind that the data that gets passed through the network can be of different types. The types used in the shader editor are: value, color, vector, and shader. The node sockets indicate the type of value the node expects as input and the type it outputs. You can easily see the type by looking at the color of the socket</p>
<ul>
<li>Values are indicated with greyish sockets</li>
<li>Colors are indicated with yellowish sockets</li>
<li>Vectors are indicated with blue/purplish sockets</li>
<li>Shaders used to be indicated with green sockets and are now indicated with red sockets.</li>
</ul>
<p>You can see the different types of sockets here:</p>
<p><img src="images/sockets.png" alt="Socket types" /></p>
<h2><a class="header" href="#different-types" id="different-types">Different types</a></h2>
<p>As long as we plug data of the same type into sockets of the right type, everything works fine. What happens when we connect two sockets of different types? Most of the time this will work, even though it might not do what you think it will. The only time it doesn't work is when you try to connect a shader socket with any other non-shader socket. In that case the connection will be made red, and the shader won't compile. If you want to convert a shader to a color you have to use the <code>Shader to RGB</code> node which only works in EEVEE. You can see the different possibilities here:</p>
<p><img src="images/sockets2.png" alt="Socket connections" /></p>
<p>So what happens when it does work? The answer depends on the types of the sockets. The following descriptions may not be one hundred percent accurate, but they do suffice for things that we need them for.</p>
<h3><a class="header" href="#color-socket" id="color-socket">Color socket</a></h3>
<p>The data stored in a color socket is made up of three values stored together as <code>(r, g, b)</code>. These are the red, green, and blue values of the color. Here are the possibilities for implicit conversion:</p>
<ul>
<li>Color -&gt; Shader. The color output gets treated as an emission shader with strength one.</li>
<li>Color -&gt; Vector. The <code>(r, g, b)</code> gets sent to <code>(x, y, z)</code>.</li>
<li>Color -&gt; Value. The returned value is the luminance: <code>0.2126729*r + 0.7151522*g + 0.0721750*b</code>. This is the same as the <code>Color to BW</code> node, and leaves grayscale values unchanged.</li>
</ul>
<h3><a class="header" href="#vector-socket" id="vector-socket">Vector socket</a></h3>
<p>The data stored in a vector socket is the same as the data stored in a color socket, except that the labels are now <code>(x, y, z)</code>. These are the conversions:</p>
<ul>
<li>Vector -&gt; Shader. Same as Vector -&gt; Color -&gt; Shader.</li>
<li>Vector -&gt; Color. The <code>(x, y, z)</code> gets mapped to <code>(r, g, b)</code>.</li>
<li>Vector -&gt; Value. The average is taken, i.e. \(\frac{1}{3}(x+y+z)\). Note that this is different from the conversion Color -&gt; Value.</li>
</ul>
<h3><a class="header" href="#value-socket" id="value-socket">Value socket</a></h3>
<p>This just stores one value, hence the name. </p>
<ul>
<li>Value -&gt; Shader. The output gets treated as an emission shader with color <code>(1.0, 1.0, 1.0)</code> (white) and strength the value.</li>
<li>Value -&gt; Color. The red, green, and blue channels are set to the value.</li>
<li>Value -&gt; Vector. The x, y and z components are set to the value.</li>
</ul>
<h3><a class="header" href="#summary" id="summary">Summary</a></h3>
<p>Converting between Color and Vector does nothing. Converting from Value to Vector or Color makes three copies of the value. Converting from Color to Value takes the luminance, and converting from Vector to Value takes the average. In this case information is lost, i.e. Vector -&gt; Value -&gt; Vector will not necessarily be the same as the original vector. Converting to Shader is done through an <code>Emission Shader</code>.</p>
<h2><a class="header" href="#separate-and-combine" id="separate-and-combine">Separate and Combine</a></h2>
<p>If you don't want to lose information because of implicit conversions, you can use the <code>Separate XYZ</code> node and the <code>Separate RGB</code> node to extract the individual components. If you then want to combine them later in the node tree you can use the <code>Combine XYZ</code> and <code>Combine RGB</code> nodes.</p>
<hr />
<h2><a class="header" href="#blender-documentation" id="blender-documentation">Blender documentation</a></h2>
<p>You can find more info <a href="https://docs.blender.org/manual/en/latest/interface/controls/nodes/parts.html#conversion">here</a>.</p>
<h2><a class="header" href="#source-code" id="source-code">Source code</a></h2>
<p>The information for how the conversion works, is based on the following snippets in the blender source. </p>
<p>intern\cycles\render\graph.cpp</p>
<pre><code class="language-cpp">if (from-&gt;type() != to-&gt;type()) {
    /* can't do automatic conversion from closure */
    if (from-&gt;type() == SocketType::CLOSURE) {
        fprintf(stderr,
                &quot;Cycles shader graph connect: can only connect closure to closure &quot;
                &quot;(%s.%s to %s.%s).\n&quot;,
                from-&gt;parent-&gt;name.c_str(),
                from-&gt;name().c_str(),
                to-&gt;parent-&gt;name.c_str(),
                to-&gt;name().c_str());
        return;
}

/* add automatic conversion node in case of type mismatch */
ShaderNode *convert;
ShaderInput *convert_in;

if (to-&gt;type() == SocketType::CLOSURE) {
    EmissionNode *emission = create_node&lt;EmissionNode&gt;();
    emission-&gt;set_color(make_float3(1.0f, 1.0f, 1.0f));
    emission-&gt;set_strength(1.0f);
    convert = add(emission);
    /* Connect float inputs to Strength to save an additional Falue-&gt;Color conversion. */
    if (from-&gt;type() == SocketType::FLOAT) {
        convert_in = convert-&gt;input(&quot;Strength&quot;);
    }
    else {
        convert_in = convert-&gt;input(&quot;Color&quot;);
    }
}
else {
    convert = add(create_node&lt;ConvertNode&gt;(from-&gt;type(), to-&gt;type(), true));
    convert_in = convert-&gt;inputs[0];
}

connect(from, convert_in);
connect(convert-&gt;outputs[0], to);
}
else {
    /* types match, just connect */
    to-&gt;link = from;
    from-&gt;links.push_back(to);
}
</code></pre>
<p>intern\render\cycles\nodes.cpp in the function <code>ConvertNode::constant_fold</code>.</p>
<pre><code class="language-cpp">if (from == SocketType::FLOAT) {
    if (SocketType::is_float3(to)) {
        folder.make_constant(make_float3(value_float, value_float, value_float));
    }
}
else if (SocketType::is_float3(from)) {
    if (to == SocketType::FLOAT) {
        if (from == SocketType::COLOR) {
            /* color to float */
            float val = folder.scene-&gt;shader_manager-&gt;linear_rgb_to_gray(value_color);
            folder.make_constant(val);
        }
        else {
            /* vector/point/normal to float */
            folder.make_constant(average(value_vector));
        }
    }
    else if (SocketType::is_float3(to)) {
        folder.make_constant(value_color);
    }
}
</code></pre>
<p>intern\cycles\render\shader.cpp</p>
<pre><code class="language-cpp">rgb_to_y = make_float3(0.2126729f, 0.7151522f, 0.0721750f);

float ShaderManager::linear_rgb_to_gray(float3 c)
{
  return dot(c, rgb_to_y);
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../mnode/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../mnode/basic_ops.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../mnode/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../mnode/basic_ops.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
